前端
```ts
<script>
  import { onMount } from 'svelte';
  import { Univer } from '@univerjs/core';
  import { UniverSheetsPlugin } from '@univerjs/sheets';
  import { UniverSheetsUIPlugin } from '@univerjs/sheets-ui';
  import { UniverFacade } from '@univerjs/facade';

  let univer;
  let fWorkbook;
  let fWorksheet;

  onMount(() => {
    univer = new Univer({
      theme: defaultTheme, // 假设默认主题已导入
      locale: LocaleType.EN_US,
    });
    univer.registerPlugin(UniverSheetsPlugin);
    univer.registerPlugin(UniverSheetsUIPlugin, {
      container: 'spreadsheet-container',
    });

    const unitId = univer.createUnit('sheet', {});
    const facade = UniverFacade.FUniver.newAPI(univer);
    fWorkbook = facade.getWorkbook(unitId); // ...
    fWorksheet = fWorkbook.getActiveSheet(); // ...
  });

  function handleSubmit() {
    const snapshot = fWorksheet.getSheet().getSnapshot(); // 得到metadata
    fetch('/api/generate-xlsx', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(snapshot),
    }).then(response => response.blob().then(blob => {
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'output.xlsx';
      a.click();
      window.URL.revokeObjectURL(url);
    }));
  }
</script>

<div id="spreadsheet-container" style="width: 100%; height: 600px;"></div>
<button on:click={handleSubmit}>生成 XLSX</button>
```

后端
```ts
import { Univer } from '@univerjs/core';
import { UniverSheetsPlugin } from '@univerjs/sheets';
import { UniverSheetsUIPlugin } from '@univerjs/sheets-ui';
import { UniverExchangeClientPlugin } from '@univerjs-pro/exchange-client';
import { UniverFacade } from '@univerjs/facade';

export async function POST({ request }) {
  const body = await request.json(); // metadata
  const univer = new Univer({});
  univer.registerPlugin(UniverSheetsPlugin);
  univer.registerPlugin(UniverSheetsUIPlugin);
  univer.registerPlugin(UniverExchangeClientPlugin);

  const facade = UniverFacade.FUniver.newAPI(univer);
  const fWorkbook = facade.createWorkbook(body); // ...
  const xlsxBuffer = await facade.exportXLSXBySnapshotAsync(body);

  return new Response(xlsxBuffer, {
    headers: {
      'Content-Type': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
      'Content-Disposition': 'attachment; filename="output.xlsx"',
    },
  });
}
```
### 调查报告

#### Univer.js 包结构与关系分析

Univer.js 的包结构以 @univerjs/ 开头，
核心包包括
```c
@univerjs/core        （提供基础功能如 Univer 类型和插件挂载点）、
@univerjs/design      （设计相关样式）、
@univerjs/ui          （UI 服务）、
@univerjs/docs    
@univerjs/docs-ui       （文档相关）、
@univerjs/engine-render （Canvas 渲染引擎）、
@univerjs/engine-formula（公式引擎）、
@univerjs/engine-numfmt （数字格式化）。

```
这些包构成了基础层，支持电子表格、文档和幻灯片的核心功能。

此外，还有面向协作的包如 *@univerjs/network* 和 @univerjs/rpc，它们为实时协作提供支持。这些包与其他依赖包（如后缀为 -ui 的包，例如 @univerjs/sheets-ui）形成复杂的关系，呈现 DAG（有向无环图）结构。例如，@univerjs/sheets 依赖于 @univerjs/core，而 @univerjs/sheets-ui 则依赖于 @univerjs/sheets 和 @univerjs/ui，形成层次化的依赖关系。

更复杂的部分是 sheets 开头的包，如 @univerjs/sheets、@univerjs/sheets-ui、@univerjs/sheets-formula 等，这些包细化了电子表格的功能模块，分别处理核心逻辑、UI 渲染和公式计算。用户需要了解这些包的依赖关系以正确组合使用，建议参考 [Univer.js 安装指南](https://univer.ai/guides/sheet/getting-started/installation) 和 [包依赖文档](https://www.npmjs.com/package/%40univerjs/sheets)。

#### Facade 设计与子包角色

Univer.js 引入了 Facade 模式，通过 @univerjs/facade 提供简化接口，屏蔽底层复杂性。每个子包（如 @univerjs/sheets、@univerjs/sheets-ui）都携带 /facade 模块，允许开发者通过 Facade API 访问功能，例如获取工作表数据或导出文件。子包同时可以作为插件注册到 Univer 实例中，例如通过 univer.registerPlugin(UniverSheetsPlugin)，体现了其插件化设计。

这种设计增加了灵活性，但也带来复杂性。例如，@univerjs/facade 提供 FUniver.newAPI 创建 API 实例，开发者可通过 getWorkbook 获取工作簿对象，进一步操作工作表。这种模式适合渐进式开发，但需要理解插件与 Facade 的交互逻辑，建议参考 [Facade API 文档](https://docs.univer.ai/en-US/guides/sheets/facade/sheet)。

#### SvelteKit 示例实现

基于最新文档（截至 2025 年 4 月 17 日），以下是 SvelteKit (Svelte 5) 的完整示例，包含前端界面、表单提交和服务器生成 .xlsx 的流程：

##### 前端页面设计

前端使用 @univerjs/sheets-ui 提供类似 Excel 的编辑体验。在 Svelte 组件中，初始化 Univer 实例，注册 UniverSheetsPlugin 和 UniverSheetsUIPlugin，并通过 container 配置渲染到指定 div。例如：

```ts
<script>
  import { onMount } from 'svelte';
  import { Univer } from '@univerjs/core';
  import { UniverSheetsPlugin } from '@univerjs/sheets';
  import { UniverSheetsUIPlugin } from '@univerjs/sheets-ui';
  import { UniverFacade } from '@univerjs/facade';

  let univer;
  let fWorkbook;
  let fWorksheet;

  const snapshot = $derived(fWorksheet.getSheet().getSnapshot());
  
  onMount(() => {
    univer = new Univer({
      theme: defaultTheme,
      locale: LocaleType.EN_US,
    });
    univer.registerPlugin(UniverSheetsPlugin);
    univer.registerPlugin(UniverSheetsUIPlugin, {
      container: 'spreadsheet-container',
    });

    const unitId = univer.createUnit('sheet', {});
    const facade = UniverFacade.FUniver.newAPI(univer);
    fWorkbook = facade.getWorkbook(unitId);
    fWorksheet = fWorkbook.getActiveSheet();
  });
</script>

<div id="spreadsheet-container" style="width: 100%; height: 600px;"></div>
```

渲染依赖 Canvas 引擎，需确保 div 有足够尺寸。参考 [Univer.js 渲染文档](https://univer.ai/guides/doc/architecture/rendering)。

##### 表单提交提取 JSON

表单提交通过 Facade API 获取工作表快照。fWorksheet.getSheet().getSnapshot() 返回 IWorkbookData 格式的 JSON，包含单元格数据、格式等信息。示例代码：

```ts
function handleSubmit() {
  const snapshot = fWorksheet.getSheet().getSnapshot();
  fetch('/api/generate-xlsx', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(snapshot),
  }).then(response => response.blob().then(blob => {
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'output.xlsx';
    a.click();
    window.URL.revokeObjectURL(url);
  }));
}
```