
svelte的代码重用难度超过React
# shadcn-svelte 解析
## 网站根目录
```markdown
sites\docs\src
├── __registry__  `scripts/build-registry.ts生成`
├── app.d.ts
├── app.html
├── content `markdown文档, 分级文档`
├── lib ***重要目录*** 前后端通用的lib
│   ├── components
│   ├── config 包括 Block(blockMeta), components(注册`dlx add`), docs(docsConfig(网站结构) + examples(连接源代码的)), site配置
│   ├── registry 包括两套组件. 组件源码都在这里, 分3个目录 block, example, ***ui***
│   ├── stores 状态存储 `svelte-persisted-store` 保存用户偏好,比如packagemanager, `style, radius, theme`
│   ├── types _docs_ _nav_ 简单ts类型
│   ├── blocks.ts _block 工具箱, 包括 block判断, highlightCode_
│   └── utils.ts _全局工具箱, 包括cn, 文档路径检查,主题, 颜色处理等_
├── routes
│   ├── (app) 随后分析
│   └── (blocks)  `(blocks)\blocks\[style]\[name]` 包含2个文件 
		├──	+page.server.ts 1. export entries on allBlockIds, 2. 根据name, style生成block, 
		└──	+page.svelte 渲染单个block
│   └── +layout.svelte
└── styles
    ├── carbon.pcss
    ├── dark.ts
    ├── globals.css
    └── markdown.pcss
```

## docs 根目录
```markdown
sites\docs\src\routes\(app)
├── +layout.svelte 同(blocks下面, 单前端文件)
├── +page.server.ts 定义actions, 处理表单验证. load函数, 解析 layout和collapsed 的信息(为email组件)
├── +page.svelte
├── blocks
│   ├── +layout.svelte
│   ├── +page.server.ts
│   └── +page.svelte
├── colors
│   └── +page.svelte
├── components
│   └── +page.ts
├── docs
│   ├── [...slug]
│   ├── +layout.server.ts  `export const load: LayoutServerLoad = async() =>({..., form: await superValidate(zod(formSchema))})`
│   ├── +layout.svelte  <ScrollArea class="h-full"><DocsSidebarNav items={docsConfig.sidebarNav} /></ScrollArea>
│   ├── +page.svelte   `export let data: {component, doc}: PageData = ..`
│   └── +page.ts
├── examples
│   ├── +layout.svelte
│   ├── +page.svelte
│   ├── +page.ts
│   ├── authentication
│   ├── cards
│   ├── dashboard
│   ├── data-table
│   ├── forms
│   ├── mail
│   ├── music
│   ├── playground
│   └── tasks
├── repro
│   └── +page.ts
├── sink
│   └── +page.svelte
└── themes
    └── +page.svelte
```

D:\npmjs-sources\shadcn-svelte-main\sites\docs\src\routes\(app)\+page.server.ts
-  `routes\(app)\+page.server.ts` 用于

```ts
import { fail } from "@sveltejs/kit";
import { zod } from "sveltekit-superforms/adapters";
import { superValidate } from "sveltekit-superforms";
import type { AnyZodObject } from "zod";
import type { Actions, PageServerLoad, RequestEvent } from "./$types.js";

import { formSchema } from "$lib/registry/default/example/form-demo.svelte";
import { formSchema as checkboxSingleSchema } from "$lib/registry/default/example/checkbox-form-single.svelte";
import { formSchema as radioGroupSchema } from "$lib/registry/default/example/radio-group-form.svelte";
import { formSchema as selectSchema } from "$lib/registry/default/example/select-form.svelte";
import { formSchema as switchSchema } from "$lib/registry/default/example/switch-form.svelte";
import { formSchema as textareaSchema } from "$lib/registry/default/example/textarea-form.svelte";
import { formSchema as comboboxFormSchema } from "$lib/registry/default/example/combobox-form.svelte";
import { formSchema as datePickerFormSchema } from "$lib/registry/default/example/date-picker-form.svelte";
import { formSchema as checkboxMultipleSchema } from "$lib/registry/default/example/checkbox-form-multiple.svelte";
// sveltekit 框架钩子, 服务端处理form action (request: RequestEvent)
export const actions: Actions = { 
    // <form action="/?/username" method="POST" use:enhance>
	username: async (e: RequestEvent) => handleForm(e, formSchema),
	checkboxSingle: async (e) => handleForm(e, checkboxSingleSchema),
	checkboxMultiple: async (e) => handleForm(e, checkboxMultipleSchema),
	radioGroup: async (e) => handleForm(e, radioGroupSchema),
	select: async (e) => handleForm(e, selectSchema),
	switch: async (e) => handleForm(e, switchSchema),
	textarea: async (e) => handleForm(e, textareaSchema),
	combobox: async (e) => handleForm(e, comboboxFormSchema),
	datePicker: async (e) => handleForm(e, datePickerFormSchema),
};

async function handleForm(event: RequestEvent, schema: AnyZodObject) { // privates
	const form = await superValidate(event, zod(schema));	
	return !form.valid ? fail(400, {form}) : { form };
}
// 框架钩子
export const load: PageServerLoad = async (event) => {
	const layoutCookie = event.cookies.get("PaneForge:layout");
	const collapsedCookie = event.cookies.get("PaneForge:collapsed");
	let layout: number[] | undefined;
	let collapsed: boolean | undefined;
	// for email component default route
	if (layoutCookie) layout = JSON.parse(layoutCookie);
	if (collapsedCookie) collapsed = JSON.parse(collapsedCookie);
	return { layout, collapsed };
};
export const prerender = true; // 钩子
```

比如 D:\npmjs-sources\shadcn-svelte-main\sites\docs\src\routes\(app)\docs\+layout.server.ts
把 serverForm的放入layout中共享

```ts
import { superValidate } from "sveltekit-superforms";
import { zod } from "sveltekit-superforms/adapters";
import type { LayoutServerLoad } from "./$types.js";

import { formSchema } from "$lib/registry/default/example/form-demo.svelte";
import { formSchema as checkboxSingleSchema } from "$lib/registry/default/example/checkbox-form-single.svelte";
import { formSchema as radioGroupSchema } from "$lib/registry/default/example/radio-group-form.svelte";
import { formSchema as selectSchema } from "$lib/registry/default/example/select-form.svelte";
import { formSchema as switchSchema } from "$lib/registry/default/example/switch-form.svelte";
import { formSchema as textareaSchema } from "$lib/registry/default/example/textarea-form.svelte";
import { formSchema as comboboxFormSchema } from "$lib/registry/default/example/combobox-form.svelte";
import { formSchema as datePickerFormSchema } from "$lib/registry/default/example/date-picker-form.svelte";
import { formSchema as checkboxMultipleSchema } from "$lib/registry/default/example/checkbox-form-multiple.svelte";

export const load: LayoutServerLoad = async () => {
	return {
		form: await superValidate(zod(formSchema)),
		checkboxSingle: await superValidate(zod(checkboxSingleSchema)),
		checkboxMultiple: await superValidate(zod(checkboxMultipleSchema)),
		radioGroup: await superValidate(zod(radioGroupSchema)),
		select: await superValidate(zod(selectSchema)),
		switch: await superValidate(zod(switchSchema)),
		textarea: await superValidate(zod(textareaSchema)),
		combobox: await superValidate(zod(comboboxFormSchema)),
		datePicker: await superValidate(zod(datePickerFormSchema)),
	};
};

export const prerender = true;

```