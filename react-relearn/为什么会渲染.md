父组件已渲染，而您的组件不符合纾困于**重新渲染**的标准，其中必须同时满足**所有以下四个条件**：

1. Your component has been rendered before i.e. it already mounted  
    你的组件在之前已经被渲染了，即它已经挂载了. current`!==`null
2. No `props` (referentially) changed.
    未更改 `props` .  `React.createElement(type:'Child", {})`
3. No any context value consumed by your component changed  
    组件使用的任何上下文值均未更改
4. Your component itself didn’t schedule an update  
    您的组件本身没有计划更新


```tsx
default function App() {
  return (
    <Parent lastChild={<ChildC />}>
      <ChildB />
    </Parent>
  );
}

function Parent({ children, lastChild, consumerChild }) {
  return ( 
    == h(div, [h(type: ChildA: {}), children, lastChild]) 用到h的都会更新
    <div className="parent">
      <ChildA />
      {children}
      {lastChild}
      <Context.Provider value={{}}>
	      {consumerChild} // 只要consumerChild用到了Context的值,那么也会更新
      </Context.Provider>
    </div>
  );
}

function ChildA() {
  return <div className="childA"></div>;
}

function ChildB() {
  return <div className="childB"></div>;
}

function ChildC() {
  return <div className="childC"></div>;
}
```

Note that bail-out is on **individual-component** level  
请注意，纾困是***在单个组件***级别上
>当组件满足纾困条件，React 将不会渲染它,但仍会继续检查其子组件是否需要任何更新。

![[performance-track.png]]
- 上面的屏幕截图是我们的 `App` 首次挂载时的调用堆栈的快照。

- 我们的应用程序由 `ReactDOM.render` 挂载，从而通过 `scheduleUpdateOnFiber` 安排更新。这是 React 更新 fiber 节点的入口点，无论 React 是否是第一次渲染组件。
- 涉及的细节太多，但我们可以识别出的一个模式是，对于 React 渲染的每个组件，它都需要调用 `beginWork`。这似乎是关于纾困行为的秘密所在。

beginWork源码:
它是一个很长的函数。它接受三个参数：`current`、`workInProgress` 和 `renderLanes`。
- `Current` 是指向现有光纤节点的指针，
- `workInProgress` 是指向正在构建以反映更新的新光纤节点的指针。
```js
	// ...omitted for brevity 
	// No pending updates or context. Bail out now.
    didReceiveUpdate = false;
	return attemptEarlyBailoutIfNoScheduledUpdate(
	  current, //!=null Bailout标准1.你的组件在之前已经被渲染了，即它已经挂载了
	  workInProgress, 
	  renderLanes,
	);
	2.oldProps === newProps
	3.hasLegacyContextChanged() === false
	4.hasScheduledUpdateOrContext === false
```

> [!NOTE]
> 为什么每次更新都涉及两个光纤节点？这称为[双缓冲](https://twitter.com/acdlite/status/978696799757086720?lang=en)，这是一种提高感知性能的优化技术。

![[奇怪渲染流程图.png]]